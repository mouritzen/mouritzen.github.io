var canvas=document.getElementById("canvas"),hasSnowflakes,ctx=canvas.getContext("2d"),w=canvas.width=window.innerWidth,h=canvas.height=window.innerHeight,particlesOnScreen=w/4<200?200:w/4,particlesArray=[],bottomFillArray=[];const date=new Date,month=date.getMonth();hasSnowflakes=!1;function random(e,t){return e+Math.random()*(t-e+1)}function clientResize(){w=canvas.width=window.innerWidth,h=canvas.height=window.innerHeight}window.addEventListener("resize",clientResize);function createSnowFlakes(){for(var e=0;e<particlesOnScreen;e++)particlesArray.push({x:Math.random()*w,y:Math.random()*h,opacity:Math.random(),speedX:random(-1,1),speedY:random(1,4),radius:random(.5,4.2)})}function drawSnowFlakes(){for(var t,n,e=0;e<particlesArray.length;e++)ctx.beginPath(),n=ctx.createRadialGradient(particlesArray[e].x+1,particlesArray[e].y+1,0,particlesArray[e].x+1,particlesArray[e].y+1,particlesArray[e].radius+1),n.addColorStop(0,"rgba(150, 150, 150,"+particlesArray[e].opacity+")"),n.addColorStop(.8,"transparent"),ctx.arc(particlesArray[e].x+1,particlesArray[e].y+1,particlesArray[e].radius+1,0,Math.PI*2,!1),ctx.fillStyle=n,t=ctx.createRadialGradient(particlesArray[e].x,particlesArray[e].y,0,particlesArray[e].x,particlesArray[e].y,particlesArray[e].radius),t.addColorStop(0,"rgba(255, 255, 255,"+particlesArray[e].opacity+")"),t.addColorStop(.8,"rgba(210, 236, 242,"+particlesArray[e].opacity+")"),t.addColorStop(1,"rgba(237, 247, 249,"+particlesArray[e].opacity+")"),ctx.arc(particlesArray[e].x,particlesArray[e].y,particlesArray[e].radius,0,Math.PI*2,!1),ctx.fillStyle=t,ctx.fill()}function moveSnowFlakes(){for(var t,n,s,o,e=0;e<particlesArray.length;e++)if(particlesArray[e].x+=particlesArray[e].speedX,particlesArray[e].y+=particlesArray[e].speedY,moveAlongAvatar(e),particlesArray[e].y-particlesArray[e].radius>h&&(particlesArray[e].x=Math.random()*w*1.5-w*.25,particlesArray[e].y=-50,particlesArray[e].speedX=random(-1,1)),t=Math.floor(particlesArray[e].x),t>0&&t<bottomFillArray.length-1&&particlesArray[e].y>h-bottomFillArray[t]){n=Math.floor(t-particlesArray[e].radius),s=Math.floor(t+particlesArray[e].radius),n<0&&(n=0),s>w-1&&(s=w-1);for(o=n;o<s;o++)bottomFillArray[o]+=particlesArray[e].radius*.5;particlesArray[e].y=-50,particlesArray[e].x=Math.random()*w*1.5-w*.25,particlesArray[e].speedX=random(-1,1)}}function moveAlongAvatar(e){let i=document.querySelector(".avatar");if(i==null)return;let s=i.getBoundingClientRect(),t={x:s.x+s.width/2,y:s.y+s.height/2},n=particlesArray[e],a=Math.sqrt((n.x-t.x)*(n.x-t.x)+(n.y-t.y)*(n.y-t.y)),o=s.width/2-a;if(o>0){let s=Math.asin((n.y-t.y)/a);n.x<t.x?particlesArray[e].x-=o*Math.cos(s):particlesArray[e].x+=o*Math.cos(s),particlesArray[e].y+=o*Math.sin(s),particlesArray[e].speedX>.5?particlesArray[e].speedX=random(0,.5):particlesArray[e].speedX<-.5&&(particlesArray[e].speedX=random(-.5,0))}}function createBottomFill(){for(var e=bottomFillArray.length;e<w;e++)bottomFillArray.push(0)}function drawBottomFill(){var e,n=Math.max.apply(null,bottomFillArray),t=(.6*h-n)*.01;ctx.beginPath(),ctx.moveTo(0,h+10);for(e=0;e<bottomFillArray.length;e++)t<0&&bottomFillArray[e]>0&&(bottomFillArray[e]+=t),e>1&&e<bottomFillArray.length-1&&(bottomFillArray[e]*=.9,bottomFillArray[e]+=.05*bottomFillArray[e-1]+.05*bottomFillArray[e+1]),ctx.lineTo(e,h-bottomFillArray[e]);ctx.lineTo(w,h+10),ctx.lineTo(0,h+10),ctx.closePath(),ctx.strokeStyle="rgba(237, 247, 249,1)",ctx.lineWidth=1,ctx.fillStyle="rgba(210, 236, 242,.9)",ctx.stroke(),ctx.fill()}function updateSeasonal(){ctx.clearRect(0,0,w,h),(month>=10||month<3)&&(hasSnowflakes||(hasSnowflakes=!0,createSnowFlakes()),w>bottomFillArray.length&&createBottomFill(),drawSnowFlakes(),moveSnowFlakes(),drawBottomFill())}setInterval(updateSeasonal,50)